<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 検索エンジン向け設定 (SEO) -->
    <title>卒業式カウントダウン</title>
    <meta name="description" content="3月13日の卒業式まであと何日かを表示します。">
    <meta name="keywords" content="卒業式,カウントダウン,あと何日">
    <meta name="robots" content="noindex,nofollow">
    
    <!-- SNS共有用設定 (OGP) -->
    <meta property="og:title" content="卒業式カウントダウン">
    <meta property="og:description" content="3月13日の卒業式まで、あと何日？">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@900&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #fffafa 0%, #ffeef2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin: 0;
        }

        .serif-bold {
            font-family: 'Noto Serif JP', serif;
            font-weight: 900;
        }

        .sakura {
            position: absolute;
            background-color: #ffc0cb;
            border-radius: 100% 0 100% 0;
            opacity: 0.5;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) translateX(0) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(110vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        .display-container {
            z-index: 10;
            text-align: center;
        }

        .day-number {
            font-size: clamp(8rem, 30vw, 18rem);
            line-height: 0.9;
            background: linear-gradient(to bottom, #db2777, #9d174d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 10px 15px rgba(219, 39, 119, 0.1));
        }

        .unit-text {
            font-size: clamp(2.5rem, 8vw, 5rem);
            color: #9d174d;
            margin-left: 0.2em;
        }

        .top-label {
            letter-spacing: 0.8em;
            text-indent: 0.8em;
            color: #be185d;
            opacity: 0.6;
            font-size: clamp(1rem, 3vw, 1.5rem);
            margin-bottom: 2rem;
        }

        .detail-info {
            margin-top: 2rem;
            color: #be185d;
            font-weight: 700;
            font-size: clamp(1rem, 4vw, 1.25rem);
            opacity: 0.7;
            border-top: 1px solid rgba(190, 24, 93, 0.1);
            padding-top: 1.5rem;
            display: inline-block;
        }
        
        #loading-holidays {
            font-size: 0.7rem;
            display: block;
            margin-top: 5px;
            font-weight: normal;
        }
    </style>
</head>
<body>

    <div id="sakura-container" class="fixed inset-0 pointer-events-none"></div>

    <div class="display-container">
        <div class="top-label serif-bold">卒業式まで</div>
        
        <div id="countdown-wrapper" class="flex flex-col items-center justify-center">
            <div class="flex items-baseline">
                <span class="serif-bold text-3xl md:text-5xl text-pink-700 mr-4 opacity-80">あと</span>
                <span id="days" class="serif-bold day-number">--</span>
                <span class="serif-bold unit-text">日</span>
            </div>
            
            <div id="weekday-wrapper" class="detail-info">
                （土日祝を除くと、あと <span id="weekday-days">--</span> 日）
                <span id="loading-holidays"></span>
            </div>
        </div>

        <div class="mt-12 text-pink-300 font-medium tracking-[0.3em] text-sm md:text-base">
            2026.03.13
        </div>
    </div>

    <script>
        const targetDate = new Date('2026-03-13T00:00:00');
        let holidays = [];

        // 日本の祝日データを取得 (内閣府のCSVまたは代替API)
        async function fetchHolidays() {
            const statusEl = document.getElementById('loading-holidays');
            
            // キャッシュ確認 (1日有効)
            const cached = localStorage.getItem('jp_holidays_cache');
            const cacheDate = localStorage.getItem('jp_holidays_date');
            if (cached && cacheDate && (new Date().getTime() - cacheDate < 86400000)) {
                holidays = JSON.parse(cached);
                update();
                return;
            }

            try {
                // 内閣府の祝日CSVはCORS制限がある場合が多いため、数多くのプロジェクトで利用されているGoogle Calendar由来のJSON等を利用するのが一般的です
                // ここでは広く使われているholidays-jp APIを例として使用します
                const response = await fetch('https://holidays-jp.github.io/api/v1/date.json');
                const data = await response.json();
                holidays = Object.keys(data); // "YYYY-MM-DD"形式の配列
                
                localStorage.setItem('jp_holidays_cache', JSON.stringify(holidays));
                localStorage.setItem('jp_holidays_date', new Date().getTime().toString());
                update();
            } catch (error) {
                console.error('祝日データの取得に失敗しました', error);
                if (statusEl) statusEl.innerText = "※祝日データの取得に失敗しました（土日のみ除外中）";
            }
        }

        function update() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const targetDay = new Date(targetDate.getFullYear(), targetDate.getMonth(), targetDate.getDate());
            
            const diffTime = targetDay - today;
            const diffTotalDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            const display = document.getElementById('days');
            const weekdayDisplay = document.getElementById('weekday-days');
            const wrapper = document.getElementById('countdown-wrapper');

            if (diffTotalDays < 0) {
                wrapper.innerHTML = `<span class="serif-bold day-number" style="font-size: clamp(4rem, 15vw, 10rem)">祝 卒業</span>`;
            } else {
                display.innerText = diffTotalDays;

                // 土日祝を除いた日数計算
                let weekdayCount = 0;
                let tempDate = new Date(today);
                
                for (let i = 0; i < diffTotalDays; i++) {
                    const dayOfWeek = tempDate.getDay(); // 0:日, 6:土
                    const dateString = tempDate.toISOString().split('T')[0];
                    
                    const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
                    const isHoliday = holidays.includes(dateString);
                    
                    if (!isWeekend && !isHoliday) {
                        weekdayCount++;
                    }
                    tempDate.setDate(tempDate.getDate() + 1);
                }
                
                weekdayDisplay.innerText = weekdayCount;
            }
        }

        function createSakura() {
            const container = document.getElementById('sakura-container');
            if (container.children.length > 40) return;

            const petal = document.createElement('div');
            petal.className = 'sakura';
            
            const size = Math.random() * 7 + 8 + 'px';
            petal.style.width = size;
            petal.style.height = size;
            petal.style.left = Math.random() * 100 + 'vw';
            
            const duration = Math.random() * 5 + 7 + 's';
            petal.style.animation = `fall ${duration} linear forwards`;

            container.appendChild(petal);
            setTimeout(() => petal.remove(), 12000);
        }

        // 初期化
        fetchHolidays();
        update();
        setInterval(update, 60000);
        setInterval(createSakura, 600);
        for(let i=0; i<10; i++) createSakura();
    </script>
</body>
</html>
